# Дашборд регионов России

## Описание

Этот проект — интерактивное веб‑приложение на базе фреймворка [Dash](https://dash.plotly.com/) для визуализации данных по регионам России.

Основные возможности:
- отображение карты России с регионами (GeoJSON‑геометрия);
- выбор региона и просмотр детализированной информации о нём;
- отображение аналитических показателей на основе подготовленных данных (`app/data/analytic`);
- навигация между страницами (главная, по регионам, архив и др.) через механизмы **Dash Pages**.

Приложение предназначено как учебный и демонстрационный пример архитектуры Dash‑проекта с:
- разбиением на страницы;
- отдельным слоем загрузки и подготовки данных (`data_loader`);
- базовыми автотестами и линтингом (ruff, mypy, pytest).


## Архитектура

### Общий обзор

Приложение организовано как пакет `app` с точкой входа [`app/app.py`](app/app.py) и набором страниц в каталоге [`app/pages`](app/pages). Для работы с данными и геометрией регионов используется сервисный слой в [`app/services`](app/services).

Ключевые элементы архитектуры:

1. **Dash + Dash Pages**
   - В файле [`app/app.py`](app/app.py) создаётся объект `Dash` и включается поддержка страниц (Dash Pages).
   - Страницы описаны в модулях каталога [`app/pages`](app/pages), например:
     - [`app/pages/home.py`](app/pages/home.py) — главная/домашняя страница;
     - [`app/pages/main_page.py`](app/pages/main_page.py) — основная страница дашборда;
     - [`app/pages/region_page.py`](app/pages/region_page.py) и [`app/pages/region.py`](app/pages/region.py) — страницы с деталями по конкретному региону;
     - [`app/pages/archive.py`](app/pages/archive.py) — архив/дополнительная страница.

2. **Layout и callbacks**
   - [`app/layout.py`](app/layout.py) — определение общего layout приложения (общий каркас страниц, шапка/навигация и т.п.).
   - [`app/callbacks`](app/callbacks) — набор модулей с callback‑функциями Dash, которые связывают компоненты интерфейса и данные:
     - [`app/callbacks/main_callbacks.py`](app/callbacks/main_callbacks.py) — callbacks для главной/основной страницы (например, обновление карт и графиков при выборе параметров);
     - [`app/callbacks/region_callbacks.py`](app/callbacks/region_callbacks.py) — callbacks для страниц регионов.

3. **Слой данных (data_loader)**

   Сервисный слой инкапсулирует логику загрузки и подготовки данных:

   - [`app/services/data_loader.py`](app/services/data_loader.py) — функции для:
     - чтения аналитических данных из `app/data/analytic/data.csv`;
     - загрузки геометрии регионов из GeoJSON файлов в `app/data/regions` и `app/data/regions/config/`;
     - сопоставления названий регионов и идентификаторов на карте по [`regions_names.json`](app/data/regions/config/regions_names.json);
     - подготовки удобных для Dash структур (pandas DataFrame, dict с геометрией и т.п.).

   Такой подход позволяет отделить бизнес‑логику от представления и упростить тестирование.

4. **Конфигурация**

   - [`app/config.py`](app/config.py) — конфигурационные параметры приложения (пути к данным, параметры запуска и т.п.).
   - `.env.default` — пример файла окружения с переменными, которые могут использоваться при запуске (например, порт, режим DEBUG).

5. **Данные**

   - [`app/data/analytic`](app/data/analytic) — табличные аналитические данные (например, метрики по регионам) в CSV.
   - [`app/data/regions`](app/data/regions) — геоданные по регионам в формате GeoJSON.
   - [`app/data/regions/config`](app/data/regions/config) — конфигурационные GeoJSON и JSON для всего набора регионов России и сопоставления названий.

6. **Тесты**

   - Каталог [`tests`](tests) содержит автоматические тесты:
     - [`tests/test_data_loader.py`](tests/test_data_loader.py) — тесты для сервисов загрузки данных (проверка корректности чтения CSV/GeoJSON, сопоставления регионов и т.д.);
     - [`tests/test_map_renderer.py`](tests/test_map_renderer.py) — тесты логики, отвечающей за отображение/подготовку карт (формирование структур для визуализации, корректность фильтрации по региону и пр.).


## Структура проекта

Основные элементы дерева проекта (неполный список):

```text
.
├── app/
│   ├── app.py              # Точка входа Dash-приложения
│   ├── app1.py             # Альтернативный/экспериментальный запуск (если используется)
│   ├── config.py           # Конфигурация приложения
│   ├── layout.py           # Общий layout приложения
│   ├── callbacks/
│   │   ├── __init__.py
│   │   ├── main_callbacks.py
│   │   └── region_callbacks.py
│   ├── data/
│   │   ├── analytic/
│   │   │   └── data.csv
│   │   └── regions/
│   │       ├── *.geojson          # Геометрия отдельных регионов
│   │       └── config/
│   │           ├── regions_names.json
│   │           ├── russia_regions.geojson
│   │           └── Russia.geojson
│   ├── pages/
│   │   ├── __init__.py
│   │   ├── home.py
│   │   ├── main_page.py
│   │   ├── region_page.py
│   │   ├── region.py
│   │   └── archive.py
│   └── services/
│       ├── __init__.py
│       └── data_loader.py
├── tests/
│   ├── __init__.py
│   ├── test_data_loader.py
│   └── test_map_renderer.py
├── pyproject.toml          # Зависимости (uv/poetry/pip) и базовая конфигурация
├── setup.cfg               # Настройки инструментов (ruff, mypy и др.)
├── uv.lock                 # Lock-файл зависимостей для uv
└── README.md
```


## Запуск приложения

Ниже предполагается, что у вас установлен Python 3.11+ и инструмент [uv](https://github.com/astral-sh/uv) (если проект на нём). Если вы используете `pip`, шаги по установке пакетов будут немного отличаться.

### 1. Клонирование репозитория

```bash
git clone <URL_РЕПОЗИТОРИЯ>
cd dashbord
```

### 2. Установка зависимостей

Через **uv** (рекомендуется, если проект уже настроен под uv, см. [`pyproject.toml`](pyproject.toml) и [`uv.lock`](uv.lock)):

```bash
uv sync
```

Через **pip** (альтернативный вариант):

```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\activate
pip install -r requirements.txt  # если такой файл имеется или pip install .
```

### 3. Переменные окружения

Скопируйте `.env.default` в `.env` и при необходимости измените значения:

```bash
cp .env.default .env
# отредактируйте .env под свои нужды (порт, DEBUG и др.)
```

### 4. Запуск Dash-приложения

Как правило, используется модуль [`app/app.py`](app/app.py) с объявлением `server` или `app`.

Примеры команд (конкретная команда может отличаться, см. `pyproject.toml`):

```bash
# Вариант 1: через uv
uv run python -m app.app

# Вариант 2: обычный запуск python
python -m app.app

# либо
python app/app.py
```

После запуска приложение будет доступно по адресу, указанному в логах (обычно http://127.0.0.1:8050/ или порт из `.env`).


## Тестирование

Для тестов используется **pytest**. Тесты лежат в каталоге [`tests`](tests).

### Запуск всех тестов

```bash
# через uv
uv run pytest

# либо напрямую
pytest
```

При запуске можно использовать стандартные опции pytest, например `-q`, `-vv`, `-k <pattern>`.


## Линтинг и статический анализ

В проекте используются как минимум:
- **ruff** — быстрый линтер и автоформаттер Python‑кода;
- **mypy** — статический анализ типов.

Настройки находятся преимущественно в [`setup.cfg`](setup.cfg) и/или [`pyproject.toml`](pyproject.toml).

### Запуск ruff

```bash
# через uv
uv run ruff check .

# либо напрямую (если ruff установлен в окружении)
ruff check .
```

При необходимости автоисправления можно использовать:

```bash
ruff check . --fix
```

### Запуск mypy

```bash
# через uv
uv run mypy .

# либо напрямую
mypy .
```

mypy проверит соответствие аннотаций типов фактическому коду согласно конфигурации в [`setup.cfg`](setup.cfg).


## Дополнительно

- Файл [`hello.py`](hello.py) и ноутбук [`service.ipynb`](service.ipynb) могут использоваться как вспомогательные/экспериментальные файлы для отладки и прототипирования.
- `.gitignore` настроен для исключения виртуальных окружений, артефактов сборки и временных файлов.

Такое разделение на страницы, сервисный слой данных, тесты и линтеры делает проект удобным для развития, экспериментов с визуализацией и обучения архитектуре Dash‑приложений.